using System;
using System.Collections.Generic;
using Helpers;
using TaleWorlds.CampaignSystem.Actions;
using TaleWorlds.CampaignSystem.CharacterDevelopment;
using TaleWorlds.CampaignSystem.Conversation;
using TaleWorlds.CampaignSystem.MapEvents;
using TaleWorlds.CampaignSystem.Party;
using TaleWorlds.CampaignSystem.Roster;
using TaleWorlds.CampaignSystem.Settlements;
using TaleWorlds.Core;
using TaleWorlds.Library;
using TaleWorlds.Localization;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.Issues
{
	// Token: 0x0200030A RID: 778
	public class HeadmanVillageNeedsDraughtAnimalsIssueBehavior : CampaignBehaviorBase
	{
		// Token: 0x06002D34 RID: 11572 RVA: 0x000BD3BF File Offset: 0x000BB5BF
		public override void RegisterEvents()
		{
			CampaignEvents.OnCheckForIssueEvent.AddNonSerializedListener(this, new Action<Hero>(this.OnCheckForIssue));
		}

		// Token: 0x06002D35 RID: 11573 RVA: 0x000BD3D8 File Offset: 0x000BB5D8
		public override void SyncData(IDataStore dataStore)
		{
		}

		// Token: 0x06002D36 RID: 11574 RVA: 0x000BD3DC File Offset: 0x000BB5DC
		private bool ConditionsHold(Hero issueGiver)
		{
			if (issueGiver.CurrentSettlement != null && issueGiver.IsHeadman)
			{
				Village village = issueGiver.CurrentSettlement.Village;
				return (village.GetProsperityLevel() == SettlementComponent.ProsperityLevel.Low || village.GetProsperityLevel() == SettlementComponent.ProsperityLevel.Mid) && (village.VillageType == DefaultVillageTypes.IronMine || village.VillageType == DefaultVillageTypes.ClayMine || village.VillageType == DefaultVillageTypes.SaltMine || village.VillageType == DefaultVillageTypes.SilverMine || village.VillageType == DefaultVillageTypes.Lumberjack);
			}
			return false;
		}

		// Token: 0x06002D37 RID: 11575 RVA: 0x000BD460 File Offset: 0x000BB660
		public void OnCheckForIssue(Hero hero)
		{
			if (this.ConditionsHold(hero))
			{
				Campaign.Current.IssueManager.AddPotentialIssueData(hero, new PotentialIssueData(new PotentialIssueData.StartIssueDelegate(this.OnSelected), typeof(HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssue), IssueBase.IssueFrequency.VeryCommon, null));
				return;
			}
			Campaign.Current.IssueManager.AddPotentialIssueData(hero, new PotentialIssueData(typeof(HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssue), IssueBase.IssueFrequency.VeryCommon));
		}

		// Token: 0x06002D38 RID: 11576 RVA: 0x000BD4C4 File Offset: 0x000BB6C4
		private IssueBase OnSelected(in PotentialIssueData pid, Hero issueOwner)
		{
			return new HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssue(issueOwner);
		}

		// Token: 0x04000D8C RID: 3468
		private const IssueBase.IssueFrequency HeadmanVillageNeedsDraughtAnimalsIssueFrequency = IssueBase.IssueFrequency.VeryCommon;

		// Token: 0x02000630 RID: 1584
		public class HeadmanVillageNeedsDraughtAnimalsIssue : IssueBase
		{
			// Token: 0x06004D0E RID: 19726 RVA: 0x00161840 File Offset: 0x0015FA40
			internal static void AutoGeneratedStaticCollectObjectsHeadmanVillageNeedsDraughtAnimalsIssue(object o, List<object> collectedObjects)
			{
				((HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssue)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
			}

			// Token: 0x06004D0F RID: 19727 RVA: 0x0016184E File Offset: 0x0015FA4E
			protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
			{
				base.AutoGeneratedInstanceCollectObjects(collectedObjects);
				collectedObjects.Add(this._selectedAnimal);
			}

			// Token: 0x06004D10 RID: 19728 RVA: 0x00161863 File Offset: 0x0015FA63
			internal static object AutoGeneratedGetMemberValue_selectedAnimal(object o)
			{
				return ((HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssue)o)._selectedAnimal;
			}

			// Token: 0x06004D11 RID: 19729 RVA: 0x00161870 File Offset: 0x0015FA70
			internal static object AutoGeneratedGetMemberValue_isQuestWithMeatOffer(object o)
			{
				return ((HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssue)o)._isQuestWithMeatOffer;
			}

			// Token: 0x06004D12 RID: 19730 RVA: 0x00161882 File Offset: 0x0015FA82
			internal static object AutoGeneratedGetMemberValue_requestedAnimalAmount(object o)
			{
				return ((HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssue)o)._requestedAnimalAmount;
			}

			// Token: 0x17000FB9 RID: 4025
			// (get) Token: 0x06004D13 RID: 19731 RVA: 0x00161894 File Offset: 0x0015FA94
			public override IssueBase.AlternativeSolutionScaleFlag AlternativeSolutionScaleFlags
			{
				get
				{
					return IssueBase.AlternativeSolutionScaleFlag.Duration;
				}
			}

			// Token: 0x17000FBA RID: 4026
			// (get) Token: 0x06004D14 RID: 19732 RVA: 0x00161897 File Offset: 0x0015FA97
			private ItemObject _meatItem
			{
				get
				{
					return Game.Current.ObjectManager.GetObject<ItemObject>("meat");
				}
			}

			// Token: 0x17000FBB RID: 4027
			// (get) Token: 0x06004D15 RID: 19733 RVA: 0x001618AD File Offset: 0x0015FAAD
			private int OfferedMeatAmount
			{
				get
				{
					return (300 + this._selectedAnimal.Value * this._requestedAnimalAmount) / this._meatItem.Value * 2;
				}
			}

			// Token: 0x17000FBC RID: 4028
			// (get) Token: 0x06004D16 RID: 19734 RVA: 0x001618D5 File Offset: 0x0015FAD5
			private int GoldRequiredForAlternativeSolution
			{
				get
				{
					return (int)((float)(this._selectedAnimal.Value * this._requestedAnimalAmount) * 0.7f);
				}
			}

			// Token: 0x17000FBD RID: 4029
			// (get) Token: 0x06004D17 RID: 19735 RVA: 0x001618F1 File Offset: 0x0015FAF1
			public override int AlternativeSolutionBaseNeededMenCount
			{
				get
				{
					return 3 + MathF.Ceiling(3f * base.IssueDifficultyMultiplier);
				}
			}

			// Token: 0x17000FBE RID: 4030
			// (get) Token: 0x06004D18 RID: 19736 RVA: 0x00161906 File Offset: 0x0015FB06
			protected override int AlternativeSolutionBaseDurationInDaysInternal
			{
				get
				{
					return 3 + MathF.Ceiling(5f * base.IssueDifficultyMultiplier);
				}
			}

			// Token: 0x17000FBF RID: 4031
			// (get) Token: 0x06004D19 RID: 19737 RVA: 0x0016191B File Offset: 0x0015FB1B
			protected override int RewardGold
			{
				get
				{
					if (this._isQuestWithMeatOffer)
					{
						return 0;
					}
					return 500 + this._selectedAnimal.Value * this._requestedAnimalAmount;
				}
			}

			// Token: 0x17000FC0 RID: 4032
			// (get) Token: 0x06004D1A RID: 19738 RVA: 0x0016193F File Offset: 0x0015FB3F
			public override TextObject IssueBriefByIssueGiver
			{
				get
				{
					return new TextObject("{=9nxTUZkO}We do have a problem. Last winter was hard on our animals. A number died from disease, and others were taken by wolves. We'd go to town to buy more, but, well, herds make a tempting target for bandits and we're not really suited to fight them. We can't afford to slaughter even the oldest and weakest of our animals because we need them to pull the plough. Maybe you can help us?[if:convo_grave][ib:demure2]", null);
				}
			}

			// Token: 0x17000FC1 RID: 4033
			// (get) Token: 0x06004D1B RID: 19739 RVA: 0x0016194C File Offset: 0x0015FB4C
			public override TextObject IssueAcceptByPlayer
			{
				get
				{
					return new TextObject("{=nvaLVB5f}Tell me your needs.", null);
				}
			}

			// Token: 0x17000FC2 RID: 4034
			// (get) Token: 0x06004D1C RID: 19740 RVA: 0x0016195C File Offset: 0x0015FB5C
			public override TextObject IssueQuestSolutionExplanationByIssueGiver
			{
				get
				{
					TextObject textObject = TextObject.Empty;
					if (this._isQuestWithMeatOffer)
					{
						textObject = new TextObject("{=aExKdXmx}We need {REQUESTED_ANIMAL_AMOUNT} {.%}{?(REQUESTED_ANIMAL_AMOUNT > 1)}{PLURAL(SELECTED_ANIMAL)}{?}{SELECTED_ANIMAL}{\\?}{.%}.[if:convo_normal][ib:demure] To be honest our village is poor and our coffers are empty. We can make payment only as meat - the meat of the old animals that we'll slaughter as soon as you bring us the new ones. We can offer {MEAT_AMOUNT} loads of meat, will you accept that, {?PLAYER.GENDER}madam{?}sir{\\?}?", null);
						textObject.SetTextVariable("MEAT_AMOUNT", this.OfferedMeatAmount);
					}
					else
					{
						textObject = new TextObject("{=TEhwK74M}We are willing to pay {REWARD}{GOLD_ICON} denars for {REQUESTED_ANIMAL_AMOUNT} healthy and strong [if:convo_normal][ib:demure]{.%}{?(REQUESTED_ANIMAL_AMOUNT > 1)}{PLURAL(SELECTED_ANIMAL)}{?}{SELECTED_ANIMAL}{\\?}{.%}. Unlike us, I'm sure you can travel distant villages easily and find the finest and cheapest ones there.", null);
						textObject.SetTextVariable("REWARD", this.RewardGold);
					}
					textObject.SetTextVariable("REQUESTED_ANIMAL_AMOUNT", this._requestedAnimalAmount);
					textObject.SetTextVariable("SELECTED_ANIMAL", this._selectedAnimal.Name);
					textObject.SetTextVariable("GOLD_ICON", "{=!}<img src=\"General\\Icons\\Coin@2x\" extend=\"8\">");
					return textObject;
				}
			}

			// Token: 0x17000FC3 RID: 4035
			// (get) Token: 0x06004D1D RID: 19741 RVA: 0x001619F0 File Offset: 0x0015FBF0
			public override TextObject IssuePlayerResponseAfterAlternativeExplanation
			{
				get
				{
					return new TextObject("{=qYSrlr4q}Maybe I should send one of my men to find the animals you need.", null);
				}
			}

			// Token: 0x17000FC4 RID: 4036
			// (get) Token: 0x06004D1E RID: 19742 RVA: 0x00161A00 File Offset: 0x0015FC00
			public override TextObject IssueAlternativeSolutionExplanationByIssueGiver
			{
				get
				{
					TextObject textObject = new TextObject("{=bvEOmHWd}I think a man who knows how to trade alongside {ALTERNATIVE_TROOP_AMOUNT} [if:convo_undecided_open]fighters can get the job done without trouble. they will need {GOLD_REQUIRED_FOR_ALTERNATIVE_SOLUTION}{GOLD_ICON} denars to buy the animals. You or one of your companions, {?PLAYER.GENDER}madam{?}sir{\\?} - it doesn't matter for us as long as you find the animals we need...", null);
					textObject.SetTextVariable("ALTERNATIVE_TROOP_AMOUNT", base.GetTotalAlternativeSolutionNeededMenCount());
					textObject.SetTextVariable("GOLD_REQUIRED_FOR_ALTERNATIVE_SOLUTION", this.GoldRequiredForAlternativeSolution);
					textObject.SetTextVariable("GOLD_ICON", "{=!}<img src=\"General\\Icons\\Coin@2x\" extend=\"8\">");
					return textObject;
				}
			}

			// Token: 0x17000FC5 RID: 4037
			// (get) Token: 0x06004D1F RID: 19743 RVA: 0x00161A4D File Offset: 0x0015FC4D
			public override TextObject IssueQuestSolutionAcceptByPlayer
			{
				get
				{
					return new TextObject("{=iq3yEuO9}All right. I will bring your animals by myself.", null);
				}
			}

			// Token: 0x17000FC6 RID: 4038
			// (get) Token: 0x06004D20 RID: 19744 RVA: 0x00161A5A File Offset: 0x0015FC5A
			public override TextObject IssueAlternativeSolutionAcceptByPlayer
			{
				get
				{
					return new TextObject("{=BMQQSeTp}I'm sure my men will find what you need and bring them to you in time.", null);
				}
			}

			// Token: 0x17000FC7 RID: 4039
			// (get) Token: 0x06004D21 RID: 19745 RVA: 0x00161A67 File Offset: 0x0015FC67
			public override TextObject IssueAlternativeSolutionResponseByIssueGiver
			{
				get
				{
					return new TextObject("{=D9LxQxNa}Thank you for your help {?PLAYER.GENDER}madam{?}sir{\\?}.[if:convo_bemused][ib:demure2] We will be waiting for your men. Good luck to you all.", null);
				}
			}

			// Token: 0x17000FC8 RID: 4040
			// (get) Token: 0x06004D22 RID: 19746 RVA: 0x00161A74 File Offset: 0x0015FC74
			public override TextObject IssueDiscussAlternativeSolution
			{
				get
				{
					return new TextObject("{=jol73R8f}We are still waiting for your men to arrive, {?PLAYER.GENDER}ma'am{?}sir{\\?}. The village needs the animals they are bringing.", null);
				}
			}

			// Token: 0x17000FC9 RID: 4041
			// (get) Token: 0x06004D23 RID: 19747 RVA: 0x00161A81 File Offset: 0x0015FC81
			public override bool IsThereAlternativeSolution
			{
				get
				{
					return true;
				}
			}

			// Token: 0x17000FCA RID: 4042
			// (get) Token: 0x06004D24 RID: 19748 RVA: 0x00161A84 File Offset: 0x0015FC84
			public override bool IsThereLordSolution
			{
				get
				{
					return false;
				}
			}

			// Token: 0x17000FCB RID: 4043
			// (get) Token: 0x06004D25 RID: 19749 RVA: 0x00161A88 File Offset: 0x0015FC88
			protected override TextObject AlternativeSolutionStartLog
			{
				get
				{
					TextObject textObject = new TextObject("{=F16k4H7R}{QUEST_GIVER.LINK} told you that {?QUEST_GIVER.GENDER}she{?}he{\\?} needs {.%}{?(REQUESTED_ANIMAL_AMOUNT > 1)}{PLURAL(SELECTED_ANIMAL)}{?}{SELECTED_ANIMAL}{\\?}{.%} for {?QUEST_GIVER.GENDER}her{?}his{\\?} village. {?QUEST_GIVER.GENDER}She{?}He{\\?} will pay you {REWARD_GOLD}{GOLD_ICON} denars when the animals are delivered. You asked your {COMPANION.LINK} and {ALTERNATIVE_TROOP_AMOUNT} of your men to deliver {REQUESTED_ANIMAL_AMOUNT} {.%}{?(REQUESTED_ANIMAL_AMOUNT > 1)}{PLURAL(SELECTED_ANIMAL)}{?}{SELECTED_ANIMAL}{\\?}{.%} to {QUEST_GIVER.LINK}. They will rejoin your party in {RETURN_DAYS} days.", null);
					textObject.SetTextVariable("ALTERNATIVE_TROOP_AMOUNT", base.GetTotalAlternativeSolutionNeededMenCount());
					textObject.SetTextVariable("REQUESTED_ANIMAL_AMOUNT", this._requestedAnimalAmount);
					textObject.SetTextVariable("SELECTED_ANIMAL", this._selectedAnimal.Name);
					textObject.SetTextVariable("RETURN_DAYS", base.GetTotalAlternativeSolutionDurationInDays());
					textObject.SetTextVariable("REWARD_GOLD", this.RewardGold);
					textObject.SetTextVariable("GOLD_ICON", "{=!}<img src=\"General\\Icons\\Coin@2x\" extend=\"8\">");
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.IssueOwner.CharacterObject, textObject, false);
					StringHelpers.SetCharacterProperties("COMPANION", base.AlternativeSolutionHero.CharacterObject, textObject, false);
					return textObject;
				}
			}

			// Token: 0x17000FCC RID: 4044
			// (get) Token: 0x06004D26 RID: 19750 RVA: 0x00161B42 File Offset: 0x0015FD42
			public override TextObject Title
			{
				get
				{
					return new TextObject("{=MXLcZPaO}Village Needs Draught Animals", null);
				}
			}

			// Token: 0x17000FCD RID: 4045
			// (get) Token: 0x06004D27 RID: 19751 RVA: 0x00161B4F File Offset: 0x0015FD4F
			public override TextObject Description
			{
				get
				{
					return new TextObject("{=Ntv5KPFe}Headman in the village requested draught animals to replace them with old ones.", null);
				}
			}

			// Token: 0x06004D28 RID: 19752 RVA: 0x00161B5C File Offset: 0x0015FD5C
			public HeadmanVillageNeedsDraughtAnimalsIssue(Hero issueOwner) : base(issueOwner, CampaignTime.DaysFromNow(30f))
			{
				this._selectedAnimal = this._possibleAnimals.GetRandomElement<ItemObject>();
				this._isQuestWithMeatOffer = (issueOwner.CurrentSettlement.Village.Hearth <= 300f);
				this._requestedAnimalAmount = MathF.Round((float)((int)(5000f / (float)this._selectedAnimal.Value)) * base.IssueDifficultyMultiplier);
			}

			// Token: 0x06004D29 RID: 19753 RVA: 0x00161C2A File Offset: 0x0015FE2A
			protected override float GetIssueEffectAmountInternal(IssueEffect issueEffect)
			{
				if (issueEffect == DefaultIssueEffects.VillageHearth)
				{
					return -0.2f;
				}
				if (issueEffect == DefaultIssueEffects.IssueOwnerPower)
				{
					return -0.1f;
				}
				return 0f;
			}

			// Token: 0x06004D2A RID: 19754 RVA: 0x00161C4D File Offset: 0x0015FE4D
			public override bool DoTroopsSatisfyAlternativeSolution(TroopRoster troopRoster, out TextObject explanation)
			{
				explanation = TextObject.Empty;
				return QuestHelper.CheckRosterForAlternativeSolution(troopRoster, base.GetTotalAlternativeSolutionNeededMenCount(), ref explanation, 2, false);
			}

			// Token: 0x06004D2B RID: 19755 RVA: 0x00161C65 File Offset: 0x0015FE65
			public override bool IsTroopTypeNeededByAlternativeSolution(CharacterObject character)
			{
				return character.Tier >= 2;
			}

			// Token: 0x06004D2C RID: 19756 RVA: 0x00161C73 File Offset: 0x0015FE73
			public override ValueTuple<SkillObject, int> GetAlternativeSolutionSkill(Hero hero)
			{
				return new ValueTuple<SkillObject, int>((hero.GetSkillValue(DefaultSkills.Riding) >= hero.GetSkillValue(DefaultSkills.Trade)) ? DefaultSkills.Riding : DefaultSkills.Trade, 120);
			}

			// Token: 0x06004D2D RID: 19757 RVA: 0x00161CA0 File Offset: 0x0015FEA0
			public override bool AlternativeSolutionCondition(out TextObject explanation)
			{
				explanation = TextObject.Empty;
				return QuestHelper.CheckRosterForAlternativeSolution(MobileParty.MainParty.MemberRoster, base.GetTotalAlternativeSolutionNeededMenCount(), ref explanation, 2, false) && QuestHelper.CheckGoldForAlternativeSolution(this.GoldRequiredForAlternativeSolution, ref explanation);
			}

			// Token: 0x06004D2E RID: 19758 RVA: 0x00161CD1 File Offset: 0x0015FED1
			public override IssueBase.IssueFrequency GetFrequency()
			{
				return IssueBase.IssueFrequency.VeryCommon;
			}

			// Token: 0x06004D2F RID: 19759 RVA: 0x00161CD4 File Offset: 0x0015FED4
			public override bool IssueStayAliveConditions()
			{
				return !base.IssueOwner.CurrentSettlement.IsRaided && !base.IssueOwner.CurrentSettlement.IsUnderRaid;
			}

			// Token: 0x06004D30 RID: 19760 RVA: 0x00161CFD File Offset: 0x0015FEFD
			public override void AlternativeSolutionStartConsequence()
			{
				GiveGoldAction.ApplyBetweenCharacters(Hero.MainHero, null, this.GoldRequiredForAlternativeSolution, false);
			}

			// Token: 0x06004D31 RID: 19761 RVA: 0x00161D14 File Offset: 0x0015FF14
			protected override bool CanPlayerTakeQuestConditions(Hero issueGiver, out IssueBase.PreconditionFlags flags, out Hero relationHero, out SkillObject skill)
			{
				flags = IssueBase.PreconditionFlags.None;
				relationHero = null;
				skill = null;
				if (issueGiver.GetRelationWithPlayer() < -10f)
				{
					flags |= IssueBase.PreconditionFlags.Relation;
					relationHero = issueGiver;
				}
				if (FactionManager.IsAtWarAgainstFaction(issueGiver.MapFaction, Hero.MainHero.MapFaction))
				{
					flags |= IssueBase.PreconditionFlags.AtWar;
				}
				return flags == IssueBase.PreconditionFlags.None;
			}

			// Token: 0x06004D32 RID: 19762 RVA: 0x00161D64 File Offset: 0x0015FF64
			protected override void OnGameLoad()
			{
			}

			// Token: 0x06004D33 RID: 19763 RVA: 0x00161D66 File Offset: 0x0015FF66
			protected override void HourlyTick()
			{
			}

			// Token: 0x06004D34 RID: 19764 RVA: 0x00161D68 File Offset: 0x0015FF68
			protected override QuestBase GenerateIssueQuest(string questId)
			{
				return new HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssueQuest(questId, base.IssueOwner, CampaignTime.DaysFromNow(30f), this._selectedAnimal, this._requestedAnimalAmount, this._isQuestWithMeatOffer, this.OfferedMeatAmount, this.RewardGold);
			}

			// Token: 0x06004D35 RID: 19765 RVA: 0x00161D9E File Offset: 0x0015FF9E
			protected override void CompleteIssueWithTimedOutConsequences()
			{
			}

			// Token: 0x17000FCE RID: 4046
			// (get) Token: 0x06004D36 RID: 19766 RVA: 0x00161DA0 File Offset: 0x0015FFA0
			protected override int CompanionSkillRewardXP
			{
				get
				{
					return (int)(500f + 700f * base.IssueDifficultyMultiplier);
				}
			}

			// Token: 0x06004D37 RID: 19767 RVA: 0x00161DB8 File Offset: 0x0015FFB8
			protected override void AlternativeSolutionEndWithSuccessConsequence()
			{
				base.IssueOwner.AddPower(10f);
				ChangeRelationAction.ApplyPlayerRelation(base.IssueOwner, 5, true, true);
				base.IssueOwner.CurrentSettlement.Village.Hearth += 30f;
				if (this._isQuestWithMeatOffer)
				{
					ItemObject @object = Game.Current.ObjectManager.GetObject<ItemObject>("meat");
					MobileParty.MainParty.ItemRoster.AddToCounts(@object, this.OfferedMeatAmount);
				}
			}

			// Token: 0x040019ED RID: 6637
			private const int IssueActiveTime = 30;

			// Token: 0x040019EE RID: 6638
			private const int QuestDuration = 30;

			// Token: 0x040019EF RID: 6639
			private const int VillageHearthConstant = 300;

			// Token: 0x040019F0 RID: 6640
			private const int AlternativeSolutionTroopTierRequirement = 2;

			// Token: 0x040019F1 RID: 6641
			private const int CompanionRequiredSkillLevel = 120;

			// Token: 0x040019F2 RID: 6642
			[CachedData]
			private readonly MBList<ItemObject> _possibleAnimals = new MBList<ItemObject>
			{
				Game.Current.ObjectManager.GetObject<ItemObject>("cow"),
				Game.Current.ObjectManager.GetObject<ItemObject>("mule"),
				Game.Current.ObjectManager.GetObject<ItemObject>("sumpter_horse")
			};

			// Token: 0x040019F3 RID: 6643
			[SaveableField(1)]
			private ItemObject _selectedAnimal;

			// Token: 0x040019F4 RID: 6644
			[SaveableField(2)]
			private bool _isQuestWithMeatOffer;

			// Token: 0x040019F5 RID: 6645
			[SaveableField(3)]
			private int _requestedAnimalAmount;
		}

		// Token: 0x02000631 RID: 1585
		public class HeadmanVillageNeedsDraughtAnimalsIssueQuest : QuestBase
		{
			// Token: 0x06004D38 RID: 19768 RVA: 0x00161E38 File Offset: 0x00160038
			internal static void AutoGeneratedStaticCollectObjectsHeadmanVillageNeedsDraughtAnimalsIssueQuest(object o, List<object> collectedObjects)
			{
				((HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssueQuest)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
			}

			// Token: 0x06004D39 RID: 19769 RVA: 0x00161E46 File Offset: 0x00160046
			protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
			{
				base.AutoGeneratedInstanceCollectObjects(collectedObjects);
				collectedObjects.Add(this._requestedAnimal);
				collectedObjects.Add(this._questProgressLogTest);
			}

			// Token: 0x06004D3A RID: 19770 RVA: 0x00161E67 File Offset: 0x00160067
			internal static object AutoGeneratedGetMemberValue_requestedAnimal(object o)
			{
				return ((HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssueQuest)o)._requestedAnimal;
			}

			// Token: 0x06004D3B RID: 19771 RVA: 0x00161E74 File Offset: 0x00160074
			internal static object AutoGeneratedGetMemberValue_requestedAnimalAmount(object o)
			{
				return ((HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssueQuest)o)._requestedAnimalAmount;
			}

			// Token: 0x06004D3C RID: 19772 RVA: 0x00161E86 File Offset: 0x00160086
			internal static object AutoGeneratedGetMemberValue_isQuestWithMeatOffer(object o)
			{
				return ((HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssueQuest)o)._isQuestWithMeatOffer;
			}

			// Token: 0x06004D3D RID: 19773 RVA: 0x00161E98 File Offset: 0x00160098
			internal static object AutoGeneratedGetMemberValue_discountValue(object o)
			{
				return ((HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssueQuest)o)._discountValue;
			}

			// Token: 0x06004D3E RID: 19774 RVA: 0x00161EAA File Offset: 0x001600AA
			internal static object AutoGeneratedGetMemberValue_offeredMeatAmount(object o)
			{
				return ((HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssueQuest)o)._offeredMeatAmount;
			}

			// Token: 0x06004D3F RID: 19775 RVA: 0x00161EBC File Offset: 0x001600BC
			internal static object AutoGeneratedGetMemberValue_questProgressLogTest(object o)
			{
				return ((HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssueQuest)o)._questProgressLogTest;
			}

			// Token: 0x17000FCF RID: 4047
			// (get) Token: 0x06004D40 RID: 19776 RVA: 0x00161EC9 File Offset: 0x001600C9
			public override TextObject Title
			{
				get
				{
					return new TextObject("{=MXLcZPaO}Village Needs Draught Animals", null);
				}
			}

			// Token: 0x17000FD0 RID: 4048
			// (get) Token: 0x06004D41 RID: 19777 RVA: 0x00161ED6 File Offset: 0x001600D6
			public override bool IsRemainingTimeHidden
			{
				get
				{
					return false;
				}
			}

			// Token: 0x17000FD1 RID: 4049
			// (get) Token: 0x06004D42 RID: 19778 RVA: 0x00161EDC File Offset: 0x001600DC
			private TextObject QuestStartedLogText
			{
				get
				{
					TextObject textObject = new TextObject("{=V7YG3nKb}{QUEST_GIVER.LINK} told you that {?QUEST_GIVER.GENDER}she{?}he{\\?} needs {.%}{?(REQUESTED_ANIMAL_AMOUNT > 1)}{PLURAL(SELECTED_ANIMAL)}{?}{SELECTED_ANIMAL}{\\?}{.%} for {?QUEST_GIVER.GENDER}her{?}his{\\?} village. {?QUEST_GIVER.GENDER}She{?}He{\\?} asked you to bring {REQUESTED_ANIMAL_AMOUNT} {.%}{?(REQUESTED_ANIMAL_AMOUNT > 1)}{PLURAL(SELECTED_ANIMAL)}{?}{SELECTED_ANIMAL}{\\?}{.%} to {?QUEST_GIVER.GENDER}her{?}him{\\?}.", null);
					textObject.SetTextVariable("REQUESTED_ANIMAL_AMOUNT", this._requestedAnimalAmount);
					textObject.SetTextVariable("SELECTED_ANIMAL", this._requestedAnimal.Name);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					return textObject;
				}
			}

			// Token: 0x17000FD2 RID: 4050
			// (get) Token: 0x06004D43 RID: 19779 RVA: 0x00161F38 File Offset: 0x00160138
			private TextObject QuestStartedLogTextWithMeat
			{
				get
				{
					TextObject textObject = new TextObject("{=7VUNi3zy}{QUEST_GIVER.LINK} will make payment as {MEAT_AMOUNT} meat when the task is done.", null);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					textObject.SetTextVariable("MEAT_AMOUNT", this._offeredMeatAmount);
					return textObject;
				}
			}

			// Token: 0x17000FD3 RID: 4051
			// (get) Token: 0x06004D44 RID: 19780 RVA: 0x00161F7C File Offset: 0x0016017C
			private TextObject QuestSuccessLogText
			{
				get
				{
					TextObject textObject = new TextObject("{=uubL3Uck}You brought {REQUESTED_ANIMAL_AMOUNT} {.%}{?(REQUESTED_ANIMAL_AMOUNT > 1)}{PLURAL(SELECTED_ANIMAL)}{?}{SELECTED_ANIMAL}{\\?}{.%} to {?QUEST_GIVER.GENDER}her{?}him{\\?} as promised.", null);
					textObject.SetTextVariable("REQUESTED_ANIMAL_AMOUNT", this._requestedAnimalAmount);
					textObject.SetTextVariable("SELECTED_ANIMAL", this._requestedAnimal.Name);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					return textObject;
				}
			}

			// Token: 0x17000FD4 RID: 4052
			// (get) Token: 0x06004D45 RID: 19781 RVA: 0x00161FD8 File Offset: 0x001601D8
			private TextObject QuestStartedLogTextWithDenars
			{
				get
				{
					TextObject textObject = new TextObject("{=7LjTNs1k}{QUEST_GIVER.LINK} will pay you {REWARD_GOLD}{GOLD_ICON} denars when the task is done.", null);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					textObject.SetTextVariable("REWARD_GOLD", this.RewardGold);
					textObject.SetTextVariable("GOLD_ICON", "{=!}<img src=\"General\\Icons\\Coin@2x\" extend=\"8\">");
					return textObject;
				}
			}

			// Token: 0x17000FD5 RID: 4053
			// (get) Token: 0x06004D46 RID: 19782 RVA: 0x00162030 File Offset: 0x00160230
			private TextObject QuestCanceledWarDeclaredLog
			{
				get
				{
					TextObject textObject = new TextObject("{=vW6kBki9}Your clan is now at war with {QUEST_GIVER.LINK}'s realm. Your agreement with {QUEST_GIVER.LINK} is canceled.", null);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					return textObject;
				}
			}

			// Token: 0x17000FD6 RID: 4054
			// (get) Token: 0x06004D47 RID: 19783 RVA: 0x00162064 File Offset: 0x00160264
			private TextObject PlayerDeclaredWarQuestLogText
			{
				get
				{
					TextObject textObject = new TextObject("{=bqeWVVEE}Your actions have started a war with {QUEST_GIVER.LINK}'s faction. {?QUEST_GIVER.GENDER}She{?}He{\\?} cancels your agreement and the quest is a failure.", null);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					return textObject;
				}
			}

			// Token: 0x17000FD7 RID: 4055
			// (get) Token: 0x06004D48 RID: 19784 RVA: 0x00162098 File Offset: 0x00160298
			private TextObject QuestGiverVillageRaided
			{
				get
				{
					TextObject textObject = new TextObject("{=gJG0xmAq}{QUEST_GIVER.LINK}'s village {QUEST_SETTLEMENT} was raided. Your agreement with {QUEST_GIVER.LINK} is canceled.", null);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					textObject.SetTextVariable("QUEST_SETTLEMENT", base.QuestGiver.CurrentSettlement.EncyclopediaLinkWithName);
					return textObject;
				}
			}

			// Token: 0x17000FD8 RID: 4056
			// (get) Token: 0x06004D49 RID: 19785 RVA: 0x001620E8 File Offset: 0x001602E8
			private TextObject QuestFailedWithTimeOutLogText
			{
				get
				{
					TextObject textObject = new TextObject("{=xvCzjcjU}You failed to deliver {REQUESTED_ANIMAL_AMOUNT} {.%}{?(REQUESTED_ANIMAL_AMOUNT > 1)}{REQUESTED_ANIMAL}{.s}{?}{REQUESTED_ANIMAL}{\\?}{.%} to {QUEST_GIVER.LINK} in time.", null);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					textObject.SetTextVariable("REQUESTED_ANIMAL_AMOUNT", this._requestedAnimalAmount);
					textObject.SetTextVariable("REQUESTED_ANIMAL", this._requestedAnimal.Name);
					return textObject;
				}
			}

			// Token: 0x06004D4A RID: 19786 RVA: 0x00162144 File Offset: 0x00160344
			public HeadmanVillageNeedsDraughtAnimalsIssueQuest(string questId, Hero giverHero, CampaignTime duration, ItemObject requestedAnimal, int requestedAnimalAmount, bool isQuestWithMeatOffer, int offeredMeatAmount, int rewardGold) : base(questId, giverHero, duration, rewardGold)
			{
				this._isQuestWithMeatOffer = isQuestWithMeatOffer;
				this._requestedAnimal = requestedAnimal;
				this._requestedAnimalAmount = requestedAnimalAmount;
				this._offeredMeatAmount = offeredMeatAmount;
				this.CalculateRequestedAnimalCountOnPlayer();
				this.SetDialogs();
				base.InitializeQuestOnCreation();
				if (!isQuestWithMeatOffer && MBRandom.RandomFloat <= 0.7f)
				{
					this._discountValue = (int)((float)this.RewardGold * 0.3f);
				}
			}

			// Token: 0x06004D4B RID: 19787 RVA: 0x001621B4 File Offset: 0x001603B4
			private void QuestAcceptedConsequences()
			{
				base.StartQuest();
				base.AddTrackedObject(base.QuestGiver.CurrentSettlement);
				TextObject textObject = new TextObject("{=yc9rGlzb}Ready to deliver {.%}{?(REQUESTED_ANIMAL_AMOUNT > 1)}{PLURAL(SELECTED_ANIMAL)}{?}{SELECTED_ANIMAL}{\\?}:{.%}", null);
				textObject.SetTextVariable("SELECTED_ANIMAL", this._requestedAnimal.Name);
				textObject.SetTextVariable("REQUESTED_ANIMAL_AMOUNT", this._requestedAnimalAmount);
				this._questProgressLogTest = base.AddDiscreteLog(this.QuestStartedLogText, textObject, this._currentAnimalAmount, this._requestedAnimalAmount, null, false);
				base.AddLog(this._isQuestWithMeatOffer ? this.QuestStartedLogTextWithMeat : this.QuestStartedLogTextWithDenars, false);
			}

			// Token: 0x06004D4C RID: 19788 RVA: 0x0016224C File Offset: 0x0016044C
			protected override void SetDialogs()
			{
				this.OfferDialogFlow = DialogFlow.CreateDialogFlow("issue_classic_quest_start", 100).NpcLine(new TextObject("{=msDCQIY7}Thank you, {?PLAYER.GENDER}madam{?}sir{\\?}. [if:convo_grateful][ib:confident]In these hard times, people like you are a gift from Heaven… The village will never forget that you were willing to help. Good luck.", null), null, null).Condition(() => Hero.OneToOneConversationHero == this.QuestGiver).Consequence(new ConversationSentence.OnConsequenceDelegate(this.QuestAcceptedConsequences)).CloseDialog();
				TextObject textObject = new TextObject("{=rRGbn0Sm}Thank you {?PLAYER.GENDER}madam{?}sir{\\?}. [if:convo_focused_happy][ib:normal]You did a great favor to people of {ISSUE_VILLAGE}.", null);
				textObject.SetTextVariable("ISSUE_VILLAGE", base.QuestGiver.CurrentSettlement.EncyclopediaLinkWithName);
				TextObject npcDiscountLine = new TextObject("{=p9rzYV4T}Things have gotten worse for the village, [if:convo_dismayed][ib:nervous2]since we last met {?PLAYER.GENDER}madam{?}sir{\\?}. Is it possible that we could pay you a bit less, what about {DISCOUNTED_REWARD}{GOLD_ICON} denars?", null);
				TextObject npcText = new TextObject("{=4kealpZK}Have you brought the animals {?PLAYER.GENDER}madam{?}sir{\\?}?", null);
				this.DiscussDialogFlow = DialogFlow.CreateDialogFlow("quest_discuss", 100).NpcLine(npcText, null, null).Condition(() => Hero.OneToOneConversationHero == this.QuestGiver).BeginPlayerOptions().PlayerOption(new TextObject("{=CjuVoxaC}Yes, Here are your animals.", null), null).Condition(new ConversationSentence.OnConditionDelegate(this.CheckIfPlayerHasEnoughAnimals)).BeginNpcOptions().NpcOption(npcDiscountLine, delegate()
				{
					if (this._discountValue > 0)
					{
						npcDiscountLine.SetTextVariable("DISCOUNTED_REWARD", this.RewardGold - this._discountValue);
						npcDiscountLine.SetTextVariable("GOLD_ICON", "{=!}<img src=\"General\\Icons\\Coin@2x\" extend=\"8\">");
						return true;
					}
					return false;
				}, null, null).BeginPlayerOptions().PlayerOption(new TextObject("{=KBmAqg54}No problem, you can pay what you can afford.", null), null).NpcLine(textObject, null, null).Consequence(new ConversationSentence.OnConsequenceDelegate(this.QuestSuccessPlayerDeliveredAnimalsWithAcceptingDiscount)).CloseDialog().PlayerOption(new TextObject("{=kYc90hEl}Sorry, but the price is what we agreed on. I can't lower it.", null), null).NpcLine(new TextObject("{=r4pLtP5V}You're right. We agreed on this price. Thank you for your efforts.[if:convo_nervous][ib:normal]", null), null, null).Consequence(new ConversationSentence.OnConsequenceDelegate(this.QuestSuccessPlayerDeliveredAnimalsWithoutAcceptingDiscount)).CloseDialog().EndPlayerOptions().NpcOption(new TextObject("{=l8ezl95j}Thank you {?PLAYER.GENDER}madam{?}sir{\\?}.[if:convo_calm_friendly] Here is what we promised.", null), null, null, null).Consequence(new ConversationSentence.OnConsequenceDelegate(this.QuestSuccessPlayerDeliveredAnimalsNormal)).CloseDialog().EndNpcOptions().PlayerOption(new TextObject("{=PI6ikMsc}I'm working on it.", null), null).NpcLine(new TextObject("{=4MQQf3wp}We are waiting for your arrival. ", null), null, null).CloseDialog().EndPlayerOptions();
			}

			// Token: 0x06004D4D RID: 19789 RVA: 0x00162434 File Offset: 0x00160634
			private void CalculateRequestedAnimalCountOnPlayer()
			{
				int num = 0;
				foreach (ItemRosterElement itemRosterElement in MobileParty.MainParty.ItemRoster)
				{
					if (itemRosterElement.EquipmentElement.Item == this._requestedAnimal)
					{
						num += itemRosterElement.Amount;
					}
				}
				this._currentAnimalAmount = num;
			}

			// Token: 0x06004D4E RID: 19790 RVA: 0x001624A8 File Offset: 0x001606A8
			private bool CheckIfPlayerHasEnoughAnimals()
			{
				this.CalculateRequestedAnimalCountOnPlayer();
				return this._currentAnimalAmount >= this._requestedAnimalAmount;
			}

			// Token: 0x06004D4F RID: 19791 RVA: 0x001624C1 File Offset: 0x001606C1
			private void QuestSuccessPlayerDeliveredAnimalsNormal()
			{
				ChangeRelationAction.ApplyPlayerRelation(base.QuestGiver, 5, true, true);
				base.QuestGiver.CurrentSettlement.Village.Hearth += 30f;
				this.ApplyRewards(false);
				base.CompleteQuestWithSuccess();
			}

			// Token: 0x06004D50 RID: 19792 RVA: 0x00162500 File Offset: 0x00160700
			private void QuestSuccessPlayerDeliveredAnimalsWithAcceptingDiscount()
			{
				ChangeRelationAction.ApplyPlayerRelation(base.QuestGiver, 8, true, true);
				TraitLevelingHelper.OnIssueSolvedThroughBetrayal(base.QuestGiver, new Tuple<TraitObject, int>[]
				{
					new Tuple<TraitObject, int>(DefaultTraits.Mercy, 30)
				});
				base.QuestGiver.CurrentSettlement.Village.Hearth += 80f;
				this.ApplyRewards(true);
				foreach (Hero hero in base.QuestGiver.CurrentSettlement.Notables)
				{
					if (hero != base.QuestGiver)
					{
						ChangeRelationAction.ApplyPlayerRelation(hero, 3, true, true);
					}
				}
				base.CompleteQuestWithSuccess();
			}

			// Token: 0x06004D51 RID: 19793 RVA: 0x001625C4 File Offset: 0x001607C4
			private void QuestSuccessPlayerDeliveredAnimalsWithoutAcceptingDiscount()
			{
				TraitLevelingHelper.OnIssueSolvedThroughBetrayal(base.QuestGiver, new Tuple<TraitObject, int>[]
				{
					new Tuple<TraitObject, int>(DefaultTraits.Mercy, -20)
				});
				ChangeRelationAction.ApplyPlayerRelation(base.QuestGiver, 5, true, true);
				base.QuestGiver.CurrentSettlement.Village.Hearth += 50f;
				this.ApplyRewards(false);
				base.CompleteQuestWithSuccess();
			}

			// Token: 0x06004D52 RID: 19794 RVA: 0x00162630 File Offset: 0x00160830
			private void ApplyRewards(bool applyDiscount)
			{
				if (this._isQuestWithMeatOffer)
				{
					ItemObject @object = Game.Current.ObjectManager.GetObject<ItemObject>("meat");
					MobileParty.MainParty.ItemRoster.AddToCounts(@object, this._offeredMeatAmount);
					using (List<Hero>.Enumerator enumerator = base.QuestGiver.CurrentSettlement.Notables.GetEnumerator())
					{
						while (enumerator.MoveNext())
						{
							Hero hero = enumerator.Current;
							if (hero != base.QuestGiver)
							{
								ChangeRelationAction.ApplyPlayerRelation(hero, 3, true, true);
							}
						}
						return;
					}
				}
				GiveGoldAction.ApplyBetweenCharacters(null, Hero.MainHero, applyDiscount ? (this.RewardGold - this._discountValue) : this.RewardGold, false);
			}

			// Token: 0x06004D53 RID: 19795 RVA: 0x001626F0 File Offset: 0x001608F0
			protected override void OnCompleteWithSuccess()
			{
				base.AddLog(this.QuestSuccessLogText, false);
				MobileParty.MainParty.ItemRoster.FindIndexOfItem(this._requestedAnimal);
				int num = 0;
				for (int i = MobileParty.MainParty.ItemRoster.Count - 1; i >= 0; i--)
				{
					ItemRosterElement itemRosterElement = MobileParty.MainParty.ItemRoster[i];
					if (itemRosterElement.EquipmentElement.Item == this._requestedAnimal)
					{
						int num2 = (itemRosterElement.Amount >= this._requestedAnimalAmount) ? (this._requestedAnimalAmount - num) : itemRosterElement.Amount;
						EquipmentElement rosterElement = new EquipmentElement(itemRosterElement.EquipmentElement.Item, itemRosterElement.EquipmentElement.ItemModifier, null, false);
						MobileParty.MainParty.ItemRoster.AddToCounts(rosterElement, -num2);
						num += itemRosterElement.Amount;
						if (num >= this._requestedAnimalAmount)
						{
							break;
						}
					}
				}
				TraitLevelingHelper.OnIssueSolvedThroughBetrayal(base.QuestGiver, new Tuple<TraitObject, int>[]
				{
					new Tuple<TraitObject, int>(DefaultTraits.Honor, 30)
				});
				base.QuestGiver.AddPower(10f);
			}

			// Token: 0x06004D54 RID: 19796 RVA: 0x00162810 File Offset: 0x00160A10
			protected override void OnTimedOut()
			{
				base.AddLog(this.QuestFailedWithTimeOutLogText, false);
				base.QuestGiver.AddPower(-10f);
				ChangeRelationAction.ApplyPlayerRelation(base.QuestGiver, -5, true, true);
				base.QuestGiver.CurrentSettlement.Village.Hearth -= 30f;
			}

			// Token: 0x06004D55 RID: 19797 RVA: 0x0016286B File Offset: 0x00160A6B
			protected override void HourlyTick()
			{
			}

			// Token: 0x06004D56 RID: 19798 RVA: 0x00162870 File Offset: 0x00160A70
			protected override void RegisterEvents()
			{
				CampaignEvents.WarDeclared.AddNonSerializedListener(this, new Action<IFaction, IFaction, DeclareWarAction.DeclareWarDetail>(this.OnWarDeclared));
				CampaignEvents.OnClanChangedKingdomEvent.AddNonSerializedListener(this, new Action<Clan, Kingdom, Kingdom, ChangeKingdomAction.ChangeKingdomActionDetail, bool>(this.OnClanChangedKingdom));
				CampaignEvents.VillageBeingRaided.AddNonSerializedListener(this, new Action<Village>(this.OnVillageRaided));
				CampaignEvents.PlayerInventoryExchangeEvent.AddNonSerializedListener(this, new Action<List<ValueTuple<ItemRosterElement, int>>, List<ValueTuple<ItemRosterElement, int>>, bool>(this.OnPlayerInventoryExchange));
				CampaignEvents.MapEventStarted.AddNonSerializedListener(this, new Action<MapEvent, PartyBase, PartyBase>(this.OnMapEventStarted));
			}

			// Token: 0x06004D57 RID: 19799 RVA: 0x001628F0 File Offset: 0x00160AF0
			private void OnMapEventStarted(MapEvent mapEvent, PartyBase attackerParty, PartyBase defenderParty)
			{
				if (QuestHelper.CheckMinorMajorCoercion(this, mapEvent, attackerParty))
				{
					QuestHelper.ApplyGenericMinorMajorCoercionConsequences(this, mapEvent);
				}
			}

			// Token: 0x06004D58 RID: 19800 RVA: 0x00162904 File Offset: 0x00160B04
			private void OnPlayerInventoryExchange(List<ValueTuple<ItemRosterElement, int>> purchasedItems, List<ValueTuple<ItemRosterElement, int>> soldItems, bool isTrading)
			{
				int num = 0;
				foreach (ValueTuple<ItemRosterElement, int> valueTuple in purchasedItems)
				{
					ItemRosterElement item = valueTuple.Item1;
					if (item.EquipmentElement.Item == this._requestedAnimal)
					{
						int num2 = num;
						item = valueTuple.Item1;
						num = num2 + item.Amount;
					}
				}
				foreach (ValueTuple<ItemRosterElement, int> valueTuple2 in soldItems)
				{
					ItemRosterElement item = valueTuple2.Item1;
					if (item.EquipmentElement.Item == this._requestedAnimal)
					{
						int num3 = num;
						item = valueTuple2.Item1;
						num = num3 - item.Amount;
					}
				}
				this._currentAnimalAmount += num;
				this._currentAnimalAmount = (int)MathF.Clamp((float)this._currentAnimalAmount, 0f, (float)this._requestedAnimalAmount);
				this._questProgressLogTest.UpdateCurrentProgress(this._currentAnimalAmount);
			}

			// Token: 0x06004D59 RID: 19801 RVA: 0x00162A24 File Offset: 0x00160C24
			private void OnVillageRaided(Village village)
			{
				if (village == base.QuestGiver.CurrentSettlement.Village)
				{
					base.AddLog(this.QuestGiverVillageRaided, false);
					base.CompleteQuestWithCancel(null);
				}
			}

			// Token: 0x06004D5A RID: 19802 RVA: 0x00162A4E File Offset: 0x00160C4E
			private void OnClanChangedKingdom(Clan clan, Kingdom oldKingdom, Kingdom newKingdom, ChangeKingdomAction.ChangeKingdomActionDetail detail, bool showNotification = true)
			{
				if (base.QuestGiver.CurrentSettlement.MapFaction.IsAtWarWith(Hero.MainHero.MapFaction))
				{
					base.CompleteQuestWithCancel(this.QuestCanceledWarDeclaredLog);
				}
			}

			// Token: 0x06004D5B RID: 19803 RVA: 0x00162A7D File Offset: 0x00160C7D
			private void OnWarDeclared(IFaction faction1, IFaction faction2, DeclareWarAction.DeclareWarDetail detail)
			{
				QuestHelper.CheckWarDeclarationAndFailOrCancelTheQuest(this, faction1, faction2, detail, this.PlayerDeclaredWarQuestLogText, this.QuestCanceledWarDeclaredLog, false);
			}

			// Token: 0x06004D5C RID: 19804 RVA: 0x00162A95 File Offset: 0x00160C95
			protected override void OnFinalize()
			{
			}

			// Token: 0x06004D5D RID: 19805 RVA: 0x00162A97 File Offset: 0x00160C97
			protected override void InitializeQuestOnGameLoad()
			{
				this.CalculateRequestedAnimalCountOnPlayer();
				this.SetDialogs();
			}

			// Token: 0x040019F6 RID: 6646
			[SaveableField(1)]
			private ItemObject _requestedAnimal;

			// Token: 0x040019F7 RID: 6647
			[SaveableField(2)]
			private int _requestedAnimalAmount;

			// Token: 0x040019F8 RID: 6648
			private int _currentAnimalAmount;

			// Token: 0x040019F9 RID: 6649
			[SaveableField(3)]
			private bool _isQuestWithMeatOffer;

			// Token: 0x040019FA RID: 6650
			[SaveableField(4)]
			private int _discountValue;

			// Token: 0x040019FB RID: 6651
			[SaveableField(5)]
			private int _offeredMeatAmount;

			// Token: 0x040019FC RID: 6652
			[SaveableField(6)]
			private JournalLog _questProgressLogTest;
		}

		// Token: 0x02000632 RID: 1586
		public class HeadmanVillageNeedsDraughtAnimalsIssueBehaviorTypeDefiner : SaveableTypeDefiner
		{
			// Token: 0x06004D5E RID: 19806 RVA: 0x00162AA5 File Offset: 0x00160CA5
			public HeadmanVillageNeedsDraughtAnimalsIssueBehaviorTypeDefiner() : base(812000)
			{
			}

			// Token: 0x06004D5F RID: 19807 RVA: 0x00162AB2 File Offset: 0x00160CB2
			protected override void DefineClassTypes()
			{
				base.AddClassDefinition(typeof(HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssue), 1, null);
				base.AddClassDefinition(typeof(HeadmanVillageNeedsDraughtAnimalsIssueBehavior.HeadmanVillageNeedsDraughtAnimalsIssueQuest), 2, null);
			}
		}
	}
}
