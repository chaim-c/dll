using System;
using System.Collections.Generic;
using TaleWorlds.CampaignSystem.Settlements;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.Issues.IssueQuestTasks
{
	// Token: 0x02000323 RID: 803
	public class ChangeCommonAreaOwnerQuestTask : QuestTaskBase
	{
		// Token: 0x06002E1A RID: 11802 RVA: 0x000C1449 File Offset: 0x000BF649
		internal static void AutoGeneratedStaticCollectObjectsChangeCommonAreaOwnerQuestTask(object o, List<object> collectedObjects)
		{
			((ChangeCommonAreaOwnerQuestTask)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x06002E1B RID: 11803 RVA: 0x000C1457 File Offset: 0x000BF657
		protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			base.AutoGeneratedInstanceCollectObjects(collectedObjects);
			collectedObjects.Add(this._alley);
			collectedObjects.Add(this._newOwner);
		}

		// Token: 0x06002E1C RID: 11804 RVA: 0x000C1478 File Offset: 0x000BF678
		internal static object AutoGeneratedGetMemberValue_alley(object o)
		{
			return ((ChangeCommonAreaOwnerQuestTask)o)._alley;
		}

		// Token: 0x06002E1D RID: 11805 RVA: 0x000C1485 File Offset: 0x000BF685
		internal static object AutoGeneratedGetMemberValue_newOwner(object o)
		{
			return ((ChangeCommonAreaOwnerQuestTask)o)._newOwner;
		}

		// Token: 0x06002E1E RID: 11806 RVA: 0x000C1492 File Offset: 0x000BF692
		public ChangeCommonAreaOwnerQuestTask(Alley alley, Hero newOwner, Action onSucceededAction, Action onFailedAction, Action onCanceledAction, Action onAlleyCapturedByPlayer, Action onAlleyClearedButNotGivenToQuestGiver, DialogFlow dialogFlow = null) : base(dialogFlow, onSucceededAction, onFailedAction, onCanceledAction)
		{
			this._alley = alley;
			this._newOwner = newOwner;
			this._onAlleyCapturedByPlayer = onAlleyCapturedByPlayer;
			this._onAlleyClearedButNotGivenToQuestGiver = onAlleyClearedButNotGivenToQuestGiver;
			this._onAlleyGivenToTarget = onSucceededAction;
		}

		// Token: 0x06002E1F RID: 11807 RVA: 0x000C14C6 File Offset: 0x000BF6C6
		public void OnCommonAreaOwnerChanged(Alley alley, Hero newOwner, Hero oldOwner)
		{
			if (this._alley == alley)
			{
				if (this._newOwner == newOwner && newOwner == Hero.MainHero)
				{
					base.Finish(QuestTaskBase.FinishStates.Success);
					return;
				}
				if (newOwner == Hero.MainHero && this._onAlleyCapturedByPlayer != null)
				{
					this._onAlleyCapturedByPlayer();
				}
			}
		}

		// Token: 0x06002E20 RID: 11808 RVA: 0x000C1505 File Offset: 0x000BF705
		public override void SetReferences()
		{
			CampaignEvents.AlleyOwnerChanged.AddNonSerializedListener(this, new Action<Alley, Hero, Hero>(this.OnCommonAreaOwnerChanged));
		}

		// Token: 0x04000DC8 RID: 3528
		[SaveableField(20)]
		private readonly Alley _alley;

		// Token: 0x04000DC9 RID: 3529
		[SaveableField(21)]
		private readonly Hero _newOwner;

		// Token: 0x04000DCA RID: 3530
		private readonly Action _onAlleyCapturedByPlayer;

		// Token: 0x04000DCB RID: 3531
		private readonly Action _onAlleyClearedButNotGivenToQuestGiver;

		// Token: 0x04000DCC RID: 3532
		private readonly Action _onAlleyGivenToTarget;
	}
}
