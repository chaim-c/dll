using System;
using System.Collections.Generic;
using TaleWorlds.Library;
using TaleWorlds.Localization;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.Settlements.Workshops
{
	// Token: 0x02000366 RID: 870
	public class Workshop : SettlementArea
	{
		// Token: 0x060032E4 RID: 13028 RVA: 0x000D446F File Offset: 0x000D266F
		internal static void AutoGeneratedStaticCollectObjectsWorkshop(object o, List<object> collectedObjects)
		{
			((Workshop)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x060032E5 RID: 13029 RVA: 0x000D4480 File Offset: 0x000D2680
		protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			base.AutoGeneratedInstanceCollectObjects(collectedObjects);
			collectedObjects.Add(this._settlement);
			collectedObjects.Add(this._owner);
			collectedObjects.Add(this._customName);
			collectedObjects.Add(this._productionProgress);
			collectedObjects.Add(this.WorkshopType);
			CampaignTime.AutoGeneratedStaticCollectObjectsCampaignTime(this.LastRunCampaignTime, collectedObjects);
		}

		// Token: 0x060032E6 RID: 13030 RVA: 0x000D44E1 File Offset: 0x000D26E1
		internal static object AutoGeneratedGetMemberValueWorkshopType(object o)
		{
			return ((Workshop)o).WorkshopType;
		}

		// Token: 0x060032E7 RID: 13031 RVA: 0x000D44EE File Offset: 0x000D26EE
		internal static object AutoGeneratedGetMemberValueLastRunCampaignTime(object o)
		{
			return ((Workshop)o).LastRunCampaignTime;
		}

		// Token: 0x060032E8 RID: 13032 RVA: 0x000D4500 File Offset: 0x000D2700
		internal static object AutoGeneratedGetMemberValueCapital(object o)
		{
			return ((Workshop)o).Capital;
		}

		// Token: 0x060032E9 RID: 13033 RVA: 0x000D4512 File Offset: 0x000D2712
		internal static object AutoGeneratedGetMemberValueInitialCapital(object o)
		{
			return ((Workshop)o).InitialCapital;
		}

		// Token: 0x060032EA RID: 13034 RVA: 0x000D4524 File Offset: 0x000D2724
		internal static object AutoGeneratedGetMemberValue_settlement(object o)
		{
			return ((Workshop)o)._settlement;
		}

		// Token: 0x060032EB RID: 13035 RVA: 0x000D4531 File Offset: 0x000D2731
		internal static object AutoGeneratedGetMemberValue_tag(object o)
		{
			return ((Workshop)o)._tag;
		}

		// Token: 0x060032EC RID: 13036 RVA: 0x000D453E File Offset: 0x000D273E
		internal static object AutoGeneratedGetMemberValue_owner(object o)
		{
			return ((Workshop)o)._owner;
		}

		// Token: 0x060032ED RID: 13037 RVA: 0x000D454B File Offset: 0x000D274B
		internal static object AutoGeneratedGetMemberValue_customName(object o)
		{
			return ((Workshop)o)._customName;
		}

		// Token: 0x060032EE RID: 13038 RVA: 0x000D4558 File Offset: 0x000D2758
		internal static object AutoGeneratedGetMemberValue_productionProgress(object o)
		{
			return ((Workshop)o)._productionProgress;
		}

		// Token: 0x17000C76 RID: 3190
		// (get) Token: 0x060032EF RID: 13039 RVA: 0x000D4565 File Offset: 0x000D2765
		public override Settlement Settlement
		{
			get
			{
				return this._settlement;
			}
		}

		// Token: 0x17000C77 RID: 3191
		// (get) Token: 0x060032F0 RID: 13040 RVA: 0x000D456D File Offset: 0x000D276D
		public override string Tag
		{
			get
			{
				return this._tag;
			}
		}

		// Token: 0x17000C78 RID: 3192
		// (get) Token: 0x060032F1 RID: 13041 RVA: 0x000D4575 File Offset: 0x000D2775
		public override Hero Owner
		{
			get
			{
				return this._owner;
			}
		}

		// Token: 0x17000C79 RID: 3193
		// (get) Token: 0x060032F2 RID: 13042 RVA: 0x000D457D File Offset: 0x000D277D
		public override TextObject Name
		{
			get
			{
				TextObject result;
				if ((result = this._customName) == null)
				{
					WorkshopType workshopType = this.WorkshopType;
					result = (((workshopType != null) ? workshopType.Name : null) ?? new TextObject("{=xWoXL2FG}Empty Workshop", null));
				}
				return result;
			}
		}

		// Token: 0x17000C7A RID: 3194
		// (get) Token: 0x060032F3 RID: 13043 RVA: 0x000D45AA File Offset: 0x000D27AA
		// (set) Token: 0x060032F4 RID: 13044 RVA: 0x000D45B2 File Offset: 0x000D27B2
		[SaveableProperty(105)]
		public WorkshopType WorkshopType { get; private set; }

		// Token: 0x17000C7B RID: 3195
		// (get) Token: 0x060032F5 RID: 13045 RVA: 0x000D45BB File Offset: 0x000D27BB
		public int ProfitMade
		{
			get
			{
				return MathF.Max(this.Capital - this.InitialCapital, 0);
			}
		}

		// Token: 0x17000C7C RID: 3196
		// (get) Token: 0x060032F6 RID: 13046 RVA: 0x000D45D0 File Offset: 0x000D27D0
		public int Expense
		{
			get
			{
				return Campaign.Current.Models.WorkshopModel.DailyExpense;
			}
		}

		// Token: 0x17000C7D RID: 3197
		// (get) Token: 0x060032F7 RID: 13047 RVA: 0x000D45E6 File Offset: 0x000D27E6
		// (set) Token: 0x060032F8 RID: 13048 RVA: 0x000D45EE File Offset: 0x000D27EE
		[SaveableProperty(115)]
		public CampaignTime LastRunCampaignTime { get; private set; }

		// Token: 0x17000C7E RID: 3198
		// (get) Token: 0x060032F9 RID: 13049 RVA: 0x000D45F7 File Offset: 0x000D27F7
		// (set) Token: 0x060032FA RID: 13050 RVA: 0x000D45FF File Offset: 0x000D27FF
		[SaveableProperty(111)]
		public int Capital { get; private set; }

		// Token: 0x17000C7F RID: 3199
		// (get) Token: 0x060032FB RID: 13051 RVA: 0x000D4608 File Offset: 0x000D2808
		// (set) Token: 0x060032FC RID: 13052 RVA: 0x000D4610 File Offset: 0x000D2810
		[SaveableProperty(112)]
		public int InitialCapital { get; private set; }

		// Token: 0x060032FD RID: 13053 RVA: 0x000D4619 File Offset: 0x000D2819
		public Workshop(Settlement settlement, string tag)
		{
			this._customName = null;
			this._settlement = settlement;
			this._tag = tag;
			this.Capital = 0;
			this.InitialCapital = 0;
		}

		// Token: 0x060032FE RID: 13054 RVA: 0x000D4644 File Offset: 0x000D2844
		public override int GetHashCode()
		{
			return this.Settlement.GetHashCode() + this._tag.GetHashCode();
		}

		// Token: 0x060032FF RID: 13055 RVA: 0x000D4660 File Offset: 0x000D2860
		public void InitializeWorkshop(Hero owner, WorkshopType type)
		{
			this.WorkshopType = type;
			this._owner = owner;
			this._owner.AddOwnedWorkshop(this);
			this.Capital = Campaign.Current.Models.WorkshopModel.InitialCapital;
			this.InitialCapital = Campaign.Current.Models.WorkshopModel.InitialCapital;
			this._productionProgress = new float[type.Productions.Count];
		}

		// Token: 0x06003300 RID: 13056 RVA: 0x000D46D1 File Offset: 0x000D28D1
		public void ChangeOwnerOfWorkshop(Hero newOwner, WorkshopType type, int capital)
		{
			this._owner.RemoveOwnedWorkshop(this);
			this._owner = newOwner;
			this._owner.AddOwnedWorkshop(this);
			this.Capital = capital;
			if (type != this.WorkshopType)
			{
				this.ChangeWorkshopProduction(type);
			}
		}

		// Token: 0x06003301 RID: 13057 RVA: 0x000D4709 File Offset: 0x000D2909
		public void ChangeWorkshopProduction(WorkshopType newWorkshopType)
		{
			this.WorkshopType = newWorkshopType;
			this._productionProgress = new float[newWorkshopType.Productions.Count];
		}

		// Token: 0x06003302 RID: 13058 RVA: 0x000D4728 File Offset: 0x000D2928
		public void SetCustomName(TextObject customName)
		{
			this._customName = customName;
		}

		// Token: 0x06003303 RID: 13059 RVA: 0x000D4731 File Offset: 0x000D2931
		public void UpdateLastRunTime()
		{
			this.LastRunCampaignTime = CampaignTime.Now;
		}

		// Token: 0x06003304 RID: 13060 RVA: 0x000D473E File Offset: 0x000D293E
		public void SetProgress(int i, float value)
		{
			this._productionProgress[i] = value;
		}

		// Token: 0x06003305 RID: 13061 RVA: 0x000D474C File Offset: 0x000D294C
		internal void AfterLoad()
		{
			if (this._productionProgress.Length != this.WorkshopType.Productions.Count)
			{
				this._productionProgress = new float[this.WorkshopType.Productions.Count];
			}
			if (this.LastRunCampaignTime == CampaignTime.Zero)
			{
				this.LastRunCampaignTime = CampaignTime.Now;
			}
		}

		// Token: 0x06003306 RID: 13062 RVA: 0x000D47AB File Offset: 0x000D29AB
		public void ChangeGold(int goldChange)
		{
			this.Capital += goldChange;
		}

		// Token: 0x06003307 RID: 13063 RVA: 0x000D47BB File Offset: 0x000D29BB
		public float GetProductionProgress(int index)
		{
			return this._productionProgress[index];
		}

		// Token: 0x06003308 RID: 13064 RVA: 0x000D47C5 File Offset: 0x000D29C5
		public override string ToString()
		{
			return this.Name.ToString() + " " + this.Settlement.ToString();
		}

		// Token: 0x0400106C RID: 4204
		[SaveableField(100)]
		private readonly Settlement _settlement;

		// Token: 0x0400106D RID: 4205
		[SaveableField(101)]
		private readonly string _tag;

		// Token: 0x0400106E RID: 4206
		[SaveableField(102)]
		private Hero _owner;

		// Token: 0x0400106F RID: 4207
		[SaveableField(103)]
		private TextObject _customName;

		// Token: 0x04001070 RID: 4208
		[SaveableField(104)]
		private float[] _productionProgress;
	}
}
