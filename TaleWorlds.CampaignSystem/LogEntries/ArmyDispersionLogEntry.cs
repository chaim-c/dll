using System;
using System.Collections.Generic;
using TaleWorlds.CampaignSystem.Party;
using TaleWorlds.Localization;
using TaleWorlds.ObjectSystem;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.LogEntries
{
	// Token: 0x020002C7 RID: 711
	public class ArmyDispersionLogEntry : LogEntry, IEncyclopediaLog, IChatNotification, IWarLog
	{
		// Token: 0x060029EE RID: 10734 RVA: 0x000B3AF5 File Offset: 0x000B1CF5
		internal static void AutoGeneratedStaticCollectObjectsArmyDispersionLogEntry(object o, List<object> collectedObjects)
		{
			((ArmyDispersionLogEntry)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x060029EF RID: 10735 RVA: 0x000B3B03 File Offset: 0x000B1D03
		protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			base.AutoGeneratedInstanceCollectObjects(collectedObjects);
			collectedObjects.Add(this._armyLeader);
			collectedObjects.Add(this._encyclopediaLinkWithName);
		}

		// Token: 0x060029F0 RID: 10736 RVA: 0x000B3B24 File Offset: 0x000B1D24
		internal static object AutoGeneratedGetMemberValueDispersionReason(object o)
		{
			return ((ArmyDispersionLogEntry)o).DispersionReason;
		}

		// Token: 0x060029F1 RID: 10737 RVA: 0x000B3B36 File Offset: 0x000B1D36
		internal static object AutoGeneratedGetMemberValue_notificationTextColor(object o)
		{
			return ((ArmyDispersionLogEntry)o)._notificationTextColor;
		}

		// Token: 0x060029F2 RID: 10738 RVA: 0x000B3B48 File Offset: 0x000B1D48
		internal static object AutoGeneratedGetMemberValue_isVisibleNotification(object o)
		{
			return ((ArmyDispersionLogEntry)o)._isVisibleNotification;
		}

		// Token: 0x060029F3 RID: 10739 RVA: 0x000B3B5A File Offset: 0x000B1D5A
		internal static object AutoGeneratedGetMemberValue_armyLeader(object o)
		{
			return ((ArmyDispersionLogEntry)o)._armyLeader;
		}

		// Token: 0x060029F4 RID: 10740 RVA: 0x000B3B67 File Offset: 0x000B1D67
		internal static object AutoGeneratedGetMemberValue_encyclopediaLinkWithName(object o)
		{
			return ((ArmyDispersionLogEntry)o)._encyclopediaLinkWithName;
		}

		// Token: 0x17000A73 RID: 2675
		// (get) Token: 0x060029F5 RID: 10741 RVA: 0x000B3B74 File Offset: 0x000B1D74
		public override CampaignTime KeepInHistoryTime
		{
			get
			{
				return CampaignTime.Weeks(1f);
			}
		}

		// Token: 0x17000A74 RID: 2676
		// (get) Token: 0x060029F6 RID: 10742 RVA: 0x000B3B80 File Offset: 0x000B1D80
		public override ChatNotificationType NotificationType
		{
			get
			{
				Hero heroObject = this._armyLeader.HeroObject;
				return base.DiplomaticNotification(((heroObject != null) ? heroObject.Clan : null) ?? null, null);
			}
		}

		// Token: 0x17000A75 RID: 2677
		// (get) Token: 0x060029F7 RID: 10743 RVA: 0x000B3BA5 File Offset: 0x000B1DA5
		public bool IsVisibleNotification
		{
			get
			{
				return this._isVisibleNotification;
			}
		}

		// Token: 0x060029F8 RID: 10744 RVA: 0x000B3BB0 File Offset: 0x000B1DB0
		public ArmyDispersionLogEntry(Army army, Army.ArmyDispersionReason reason)
		{
			this._armyLeader = army.ArmyOwner.CharacterObject;
			this._encyclopediaLinkWithName = army.EncyclopediaLinkWithName;
			Kingdom kingdom = army.Kingdom;
			this._notificationTextColor = ((kingdom != null) ? kingdom.LabelColor : 0U);
			this.DispersionReason = reason;
			this._isVisibleNotification = (army.LeaderParty.MapFaction == Hero.MainHero.MapFaction && army.Parties.IndexOf(MobileParty.MainParty) >= 0);
		}

		// Token: 0x060029F9 RID: 10745 RVA: 0x000B3C35 File Offset: 0x000B1E35
		public override string ToString()
		{
			return this.GetEncyclopediaText().ToString();
		}

		// Token: 0x060029FA RID: 10746 RVA: 0x000B3C44 File Offset: 0x000B1E44
		public bool IsRelatedToWar(StanceLink stance, out IFaction effector, out IFaction effected)
		{
			IFaction faction = stance.Faction1;
			IFaction faction2 = stance.Faction2;
			effector = this._armyLeader.HeroObject.MapFaction;
			effected = null;
			return this._armyLeader.HeroObject.MapFaction == faction || this._armyLeader.HeroObject.MapFaction == faction2;
		}

		// Token: 0x060029FB RID: 10747 RVA: 0x000B3C9C File Offset: 0x000B1E9C
		public TextObject GetNotificationText()
		{
			return this.GetEncyclopediaText();
		}

		// Token: 0x060029FC RID: 10748 RVA: 0x000B3CA4 File Offset: 0x000B1EA4
		public bool IsVisibleInEncyclopediaPageOf<T>(T obj) where T : MBObjectBase
		{
			return this._armyLeader != null && obj == this._armyLeader.HeroObject;
		}

		// Token: 0x060029FD RID: 10749 RVA: 0x000B3CC4 File Offset: 0x000B1EC4
		public TextObject GetEncyclopediaText()
		{
			TextObject textObject;
			switch (this.DispersionReason)
			{
			case Army.ArmyDispersionReason.Unknown:
				textObject = new TextObject("{=5CJOMH90}{ARMY} has been disbanded.", null);
				break;
			case Army.ArmyDispersionReason.DismissalRequestedWithInfluence:
				textObject = new TextObject("{=bAVZloaC}{ARMY} has been disbanded since dismissal is requested.", null);
				break;
			case Army.ArmyDispersionReason.NotEnoughParty:
				textObject = new TextObject("{=s2lKb22C}{ARMY} has been disbanded since other parties has left the army.", null);
				break;
			case Army.ArmyDispersionReason.KingdomChanged:
				textObject = new TextObject("{=6XAvdeEE}{ARMY} has been disbanded since kingdom has been changed.", null);
				break;
			case Army.ArmyDispersionReason.CohesionDepleted:
				textObject = new TextObject("{=ESM0NhLy}{ARMY} has been disbanded since cohesion has been depleted.", null);
				break;
			case Army.ArmyDispersionReason.ObjectiveFinished:
				textObject = new TextObject("{=6XRt8101}{ARMY} has been disbanded since the objective is finished", null);
				break;
			case Army.ArmyDispersionReason.LeaderPartyRemoved:
				textObject = new TextObject("{=A3HdRbqf}{ARMY} has been disbanded since the leader party has left the army.", null);
				break;
			case Army.ArmyDispersionReason.PlayerTakenPrisoner:
				textObject = new TextObject("{=loEI5awS}{ARMY} has been disbanded since the player has taken as a prisoner", null);
				break;
			case Army.ArmyDispersionReason.CannotElectNewLeader:
				textObject = new TextObject("{=7DCzgGNP}{ARMY} has been disbanded since a new leader cannot be selected", null);
				break;
			case Army.ArmyDispersionReason.LeaderCannotArrivePointOnTime:
				textObject = new TextObject("{=t5Y0gTGv}{ARMY} has been disbanded since the leader couldn't arrived to the point on time.", null);
				break;
			case Army.ArmyDispersionReason.ArmyLeaderIsDead:
				textObject = new TextObject("{=t6FNeiOC}{ARMY} has been disbanded since the army leader is dead.", null);
				break;
			default:
				textObject = new TextObject("{=5CJOMH90}{ARMY} has been disbanded.", null);
				break;
			}
			TextObject textObject2 = new TextObject("{=nbmctMLk}{LEADER_NAME}{.o} Army", null);
			textObject2.SetTextVariable("LEADER_NAME", this._armyLeader.Name);
			textObject.SetTextVariable("ARMY", textObject2);
			return textObject;
		}

		// Token: 0x04000C99 RID: 3225
		[SaveableField(30)]
		public readonly Army.ArmyDispersionReason DispersionReason;

		// Token: 0x04000C9A RID: 3226
		[SaveableField(31)]
		private readonly uint _notificationTextColor;

		// Token: 0x04000C9B RID: 3227
		[SaveableField(32)]
		private readonly bool _isVisibleNotification;

		// Token: 0x04000C9C RID: 3228
		[SaveableField(33)]
		private readonly CharacterObject _armyLeader;

		// Token: 0x04000C9D RID: 3229
		[SaveableField(34)]
		private readonly TextObject _encyclopediaLinkWithName;
	}
}
