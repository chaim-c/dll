using System;
using System.Collections.Generic;
using TaleWorlds.CampaignSystem.Actions;
using TaleWorlds.CampaignSystem.Extensions;
using TaleWorlds.CampaignSystem.Party;
using TaleWorlds.CampaignSystem.Settlements;
using TaleWorlds.Localization;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.LogEntries
{
	// Token: 0x020002F0 RID: 752
	public class SiegeAftermathLogEntry : LogEntry
	{
		// Token: 0x06002BD3 RID: 11219 RVA: 0x000B8EA3 File Offset: 0x000B70A3
		internal static void AutoGeneratedStaticCollectObjectsSiegeAftermathLogEntry(object o, List<object> collectedObjects)
		{
			((SiegeAftermathLogEntry)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x06002BD4 RID: 11220 RVA: 0x000B8EB1 File Offset: 0x000B70B1
		protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			base.AutoGeneratedInstanceCollectObjects(collectedObjects);
			collectedObjects.Add(this._capturedSettlement);
			collectedObjects.Add(this._decisionMaker);
		}

		// Token: 0x06002BD5 RID: 11221 RVA: 0x000B8ED2 File Offset: 0x000B70D2
		internal static object AutoGeneratedGetMemberValue_siegeAftermath(object o)
		{
			return ((SiegeAftermathLogEntry)o)._siegeAftermath;
		}

		// Token: 0x06002BD6 RID: 11222 RVA: 0x000B8EE4 File Offset: 0x000B70E4
		internal static object AutoGeneratedGetMemberValue_capturedSettlement(object o)
		{
			return ((SiegeAftermathLogEntry)o)._capturedSettlement;
		}

		// Token: 0x06002BD7 RID: 11223 RVA: 0x000B8EF1 File Offset: 0x000B70F1
		internal static object AutoGeneratedGetMemberValue_decisionMaker(object o)
		{
			return ((SiegeAftermathLogEntry)o)._decisionMaker;
		}

		// Token: 0x06002BD8 RID: 11224 RVA: 0x000B8EFE File Offset: 0x000B70FE
		internal static object AutoGeneratedGetMemberValue_playerWasInvolved(object o)
		{
			return ((SiegeAftermathLogEntry)o)._playerWasInvolved;
		}

		// Token: 0x06002BD9 RID: 11225 RVA: 0x000B8F10 File Offset: 0x000B7110
		public SiegeAftermathLogEntry(MobileParty leaderParty, IEnumerable<MobileParty> attackers, Settlement settlement, SiegeAftermathAction.SiegeAftermath siegeAftermath)
		{
			this._siegeAftermath = siegeAftermath;
			this._decisionMaker = leaderParty.LeaderHero;
			this._capturedSettlement = settlement;
			this._playerWasInvolved = false;
			using (IEnumerator<MobileParty> enumerator = attackers.GetEnumerator())
			{
				while (enumerator.MoveNext())
				{
					if (enumerator.Current == MobileParty.MainParty)
					{
						this._playerWasInvolved = true;
						break;
					}
				}
			}
		}

		// Token: 0x06002BDA RID: 11226 RVA: 0x000B8F88 File Offset: 0x000B7188
		public override ImportanceEnum GetImportanceForClan(Clan clan)
		{
			return ImportanceEnum.Zero;
		}

		// Token: 0x06002BDB RID: 11227 RVA: 0x000B8F8C File Offset: 0x000B718C
		public override void GetConversationScoreAndComment(Hero talkTroop, bool findString, out string comment, out ImportanceEnum score)
		{
			score = ImportanceEnum.Zero;
			comment = "";
			if (this._playerWasInvolved && Hero.MainHero.CurrentSettlement == this._capturedSettlement && Hero.OneToOneConversationHero.IsNotable)
			{
				score = ImportanceEnum.VeryImportant;
				if (this._siegeAftermath == SiegeAftermathAction.SiegeAftermath.ShowMercy)
				{
					comment = "str_comment_endplayerbattle_you_stormed_this_city_showed_mercy";
				}
				if (this._siegeAftermath == SiegeAftermathAction.SiegeAftermath.Devastate)
				{
					comment = "str_comment_endplayerbattle_you_stormed_this_city_devastated";
				}
				if (this._siegeAftermath == SiegeAftermathAction.SiegeAftermath.Pillage)
				{
					comment = "str_comment_endplayerbattle_you_stormed_this_city";
				}
			}
		}

		// Token: 0x06002BDC RID: 11228 RVA: 0x000B8FFD File Offset: 0x000B71FD
		public override string ToString()
		{
			return this.GetNotificationText().ToString();
		}

		// Token: 0x06002BDD RID: 11229 RVA: 0x000B900C File Offset: 0x000B720C
		public TextObject GetNotificationText()
		{
			TextObject textObject = null;
			if (this._siegeAftermath == SiegeAftermathAction.SiegeAftermath.ShowMercy)
			{
				textObject = new TextObject("{=wTh00qoj}{HERO.NAME} has showed mercy to {SETTLEMENT}.", null);
			}
			if (this._siegeAftermath == SiegeAftermathAction.SiegeAftermath.Devastate)
			{
				textObject = new TextObject("{=NeTp63aU}{HERO.NAME} has devastated {SETTLEMENT}.", null);
			}
			if (this._siegeAftermath == SiegeAftermathAction.SiegeAftermath.Pillage)
			{
				textObject = new TextObject("{=VzAqZucZ}{HERO.NAME} has pillaged {SETTLEMENT}.", null);
			}
			if (this._decisionMaker != null)
			{
				textObject.SetCharacterProperties("HERO", this._decisionMaker.CharacterObject, false);
			}
			textObject.SetTextVariable("SETTLEMENT", this._capturedSettlement.Name);
			return textObject;
		}

		// Token: 0x04000D23 RID: 3363
		[SaveableField(10)]
		private readonly SiegeAftermathAction.SiegeAftermath _siegeAftermath;

		// Token: 0x04000D24 RID: 3364
		[SaveableField(20)]
		private readonly Settlement _capturedSettlement;

		// Token: 0x04000D25 RID: 3365
		[SaveableField(30)]
		private readonly Hero _decisionMaker;

		// Token: 0x04000D26 RID: 3366
		[SaveableField(40)]
		private readonly bool _playerWasInvolved;
	}
}
